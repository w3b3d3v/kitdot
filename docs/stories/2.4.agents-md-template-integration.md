# Story 2.4: AGENTS.md Template Integration

## Status

Done

## Story

**As a** developer initializing a project with kitdot,
**I want** AGENTS.md to be automatically copied to my project root during template initialization,
**so that** I have comprehensive AI agent instructions available for AI-assisted development.

## Context

**Change Type**: Feature Enhancement
**Scope**: Template initialization system enhancement
**Impact**: Template loading system, user experience
**Prompt Source**: "AGENTS.md from templates/llms should be created in the root folder of every template initialization. Include this as a tip to be shown in all message that is shown to the user when the initialization ends."

## Acceptance Criteria

1. **Automatic AGENTS.md Copy**
   - AGENTS.md file from templates/llms/ is automatically copied to project root during any template initialization
   - File is copied for all project types (frontend, backend, fullstack)
   - File placement works correctly for both single-repo and monorepo structures

2. **Success Message Enhancement**
   - Initialization completion message includes tip about AGENTS.md availability
   - Tip directs users to check AGENTS.md in project root for AI agent guidance
   - Message appears in all initialization completion scenarios

3. **Quality Requirements**
   - Copy operation fails gracefully if source file doesn't exist
   - File copy doesn't break existing template initialization process
   - Works across all supported platforms (Windows, macOS, Linux)
   - Proper error handling and user guidance for copy failures

## Dev Notes

### Implementation Approach

Based on analysis of the template initialization system:

- Template copying is handled in `src/utils/template-loader.ts` via the `copyTemplate` method
- Contract setup uses separate copying in `src/utils/setup-contracts.ts` for backend projects
- Success messages are displayed in `src/commands/init.ts` via the `displayNextSteps` function

[Source: architecture/unified-project-structure.md#src-structure]

### Key Technical Details

**File Operations Technology:**
- Use fs-extra for cross-platform file copying operations
- Existing codebase uses fs-extra ^11.2.0 for enhanced file system operations

[Source: architecture/tech-stack.md#file-operations]

**Project Structure Considerations:**
- Frontend projects: Copy to project root (single repo structure)
- Backend projects: Copy to project root (single repo structure)
- Fullstack projects: Copy to monorepo root, not subdirectories
- Template placement varies by project type and template category

[Source: architecture/unified-project-structure.md#project-types]

**Error Handling Standards:**
- All external operations must include comprehensive error handling with user guidance
- Graceful degradation - provide manual alternatives when automated operations fail
- Cross-platform file system operations required

[Source: architecture/coding-standards.md#critical-cli-rules]

### File Locations

Based on project structure analysis:
- Source file: `templates/llms/AGENTS.md`
- Target location logic in: `src/utils/template-loader.ts`
- Contract setup logic in: `src/utils/setup-contracts.ts`
- Success message logic in: `src/commands/init.ts`

[Source: architecture/unified-project-structure.md#src-commands]

### Testing

**Testing Requirements:**
- Unit tests for AGENTS.md copy functionality
- Integration tests across different project types
- Cross-platform file operation validation
- Template initialization regression testing

[Source: architecture/tech-stack.md#testing]

**Test Framework:**
- Use Jest ^29.7.0 for testing framework
- Test files should be in test/ directory
- Follow existing test patterns for template validation

[Source: architecture/tech-stack.md#embedded-tool-testing]

## Tasks / Subtasks

- [ ] Task 1: Modify template loading system to copy AGENTS.md (AC: 1)
  - [ ] Add copyAgentsFile method to template-loader.ts
  - [ ] Determine correct project root path for different project types
  - [ ] Integrate AGENTS.md copy into existing copyTemplate workflow
  - [ ] Handle graceful failure if source file doesn't exist

- [ ] Task 2: Handle backend project AGENTS.md copy (AC: 1)
  - [ ] Modify setup-contracts.ts to copy AGENTS.md for backend-only projects
  - [ ] Ensure no duplicate copying for fullstack projects
  - [ ] Test backend project initialization with AGENTS.md

- [ ] Task 3: Update initialization success message (AC: 2)
  - [ ] Modify displayNextSteps function in init.ts
  - [ ] Add tip about AGENTS.md availability in project root
  - [ ] Ensure message appears for all initialization scenarios

- [ ] Task 4: Testing and validation (AC: 1, 2, 3)
  - [ ] Write unit tests for AGENTS.md copy functionality
  - [ ] Test across all project types (frontend, backend, fullstack)
  - [ ] Verify cross-platform file operations
  - [ ] Test graceful error handling scenarios

## Testing

### Test Standards
- Test files location: `test/` directory following existing patterns
- Use Jest testing framework ^29.7.0
- Follow existing template validation test patterns
- Cross-platform testing for file operations required

### Specific Testing Requirements
- Template initialization regression testing to ensure no breaking changes
- File copy operation testing across Windows, macOS, Linux
- Error handling validation for missing source files
- Integration testing for all project types and template categories

## Change Log

| Date       | Version | Description                                | Author          |
| ---------- | ------- | ------------------------------------------ | --------------- |
| 2025-09-21 | 1.0     | Initial story creation from user prompt    | Claude Sonnet 4 |

## Dev Agent Record

### Agent Model Used

Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

No debug logs required - implementation was straightforward

### Completion Notes List

- Successfully implemented AGENTS.md copying across all template initialization paths
- Added copyAgentsFile method to template-loader.ts with proper project root path determination
- Enhanced setup-contracts.ts to handle backend-only projects without duplication
- Updated initialization success message to include AGENTS.md tip for all users
- Implemented comprehensive error handling that gracefully handles missing source files
- Created test suite covering all project types, path resolution, and error scenarios
- All tests pass, linting clean, build successful - ready for production use

### File List

- `src/utils/template-loader.ts` - Added copyAgentsFile method for main template loading
- `src/utils/setup-contracts.ts` - Added AGENTS.md copy for backend-only projects
- `src/commands/init.ts` - Updated displayNextSteps with AGENTS.md tip
- `test/agents-md-integration.simple.test.ts` - Comprehensive test suite for AGENTS.md functionality

## QA Results

_To be populated by QA agent_