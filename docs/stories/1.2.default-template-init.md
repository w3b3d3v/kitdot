# Story 1.2: default-template-init

## Status

Done

## Story

**As a** developer using kitdot CLI,
**I want** to be prompted to install the default template with [Y/n] during `kitdot init`,
**so that** I can quickly bootstrap a project without having to navigate template selection menus unless I specifically choose to customize.

## Acceptance Criteria

1. When running `kitdot init`, the CLI should first prompt: "Install default template [Y/n]?"
2. If user selects "Y" (or presses Enter for default), skip template selection and use the default template
3. If user selects "n", show the existing full-stack/frontend/backend selection flow
4. The default template should be personalized with the project name in package.json files for both contracts and frontend
5. Default template should be the local "templates/default" directory (fullstack template)
6. Project name should still be prompted for or taken from command line argument
7. All existing functionality should remain intact when using non-default flow

## Tasks / Subtasks

- [x] Modify init command to add default template prompt (AC: 1)
  - [x] Add new prompt before existing template selection logic
  - [x] Handle Y/n/Enter input validation
- [x] Implement default template selection logic (AC: 2, 5)
  - [x] Set default template to local "templates/default" directory
  - [x] Skip existing template selection when default is chosen
- [x] Preserve existing template selection for non-default flow (AC: 3, 7)
  - [x] Ensure existing full-stack/frontend/backend flow works when "n" is selected
- [x] Add template personalization functionality (AC: 4)
  - [x] Modify template-loader to replace project name placeholders in package.json files
  - [x] Identify package.json files in both contracts and frontend directories
  - [x] Replace name field with actual project name
- [x] Test both flows work correctly (AC: 6, 7)
  - [x] Test default template flow with Y/Enter
  - [x] Test non-default flow with "n"
  - [x] Verify project name handling in both scenarios

## Dev Notes

### Relevant Source Tree info

- Main init logic: `src/commands/init.ts` - contains `gatherProjectInfo()` and `createProject()` functions
- Template registry: `src/templates/registry.ts` - defines available templates including "basic-polkadot-dapp"
- Template loading: `src/utils/template-loader.ts` - handles template fetching and setup
- Home screen: `src/utils/homeScreen.ts` - displays CLI welcome screen
- Project structure: `src/utils/project-structure.ts` - creates project directories and files

### Current Flow Analysis

1. `initCommand()` calls `displayHomeScreen()` then `gatherProjectInfo()`
2. `gatherProjectInfo()` prompts for project name (if not provided) then project type selection
3. Template selection happens based on project type (fullstack/frontend/backend)
4. `createProject()` handles actual project creation with features determination

### Key Implementation Points

- Default template should be local "templates/default" directory (fullstack category)
- Need to add new prompt before existing `gatherProjectInfo()` logic
- Template personalization needs to happen during template loading/setup phase
- Project name should still be collected normally
- Current package.json names: "create-polkadot-dapp-frontend" and "create-polkadot-dapp-contracts"

### Testing

#### Test file location

- Tests should be in `test/` directory following existing patterns
- Look for existing test files like `test/platform-detection-rust-installation.test.ts`

#### Test standards

- Follow existing TypeScript testing patterns in the codebase
- Test both default and non-default flows
- Mock inquirer prompts for automated testing
- Verify file system operations for template personalization

#### Testing frameworks and patterns to use

- Use existing testing framework (likely Jest based on tech stack)
- Mock external dependencies (inquirer, file system operations)
- Test error handling for invalid inputs

#### Specific testing requirements for this story

- Test default template prompt with Y/n/Enter inputs
- Test template personalization replaces project names correctly
- Test non-default flow preserves existing behavior
- Test project name handling in both scenarios

## Change Log

| Date       | Version | Description            | Author   |
| ---------- | ------- | ---------------------- | -------- |
| 2025-09-20 | 1.0     | Initial story creation | se-agent |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-20250514

### Debug Log References

- test-default-template.js: Integration test verifying template registry and local template setup
- test-personalization.js: Comprehensive test for package.json personalization functionality

### Completion Notes List

- Successfully implemented default template prompt with Y/n validation using inquirer confirm type
- Added "default" template entry to template registry pointing to local templates/default directory
- Modified gatherProjectInfo() to handle both default and non-default flows cleanly
- Enhanced template-loader with personalization capability for package.json files
- Personalization replaces "create-polkadot-dapp-\*" names with actual project names
- Both integration and personalization tests pass successfully
- Code passes TypeScript compilation and ESLint checks
- All acceptance criteria verified through testing

### File List

- **Modified**: src/commands/init.ts - Added default template prompt and flow logic
- **Modified**: src/templates/registry.ts - Added "default" template entry for local template
- **Modified**: src/utils/template-loader.ts - Enhanced with personalization methods for package.json files
- **Created**: test-default-template.js - Integration test for default template functionality
- **Created**: test-personalization.js - Test for template personalization features
- **Referenced**: templates/default/frontend/package.json - Target for personalization
- **Referenced**: templates/default/contracts/package.json - Target for personalization

## QA Results

(To be populated by QA Agent)
